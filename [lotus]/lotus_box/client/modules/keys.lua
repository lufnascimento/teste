-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
local KEYS = {}

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- CALLBACKS
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback('GetKeys', function(data, cb)
    cb(KEYS)
end)

RegisterNUICallback('BuyKey', function(data, cb)
    cb(Execute.buyKeys(data.key.id))
end)

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- THREADS
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
    for index in pairs(Config.Keys) do
        local key = Config.Keys[index]
        
        local gen_id = (#KEYS + 1)
        KEYS[gen_id] = {
            id = index,
            name = key.name,
            type = 'key',
            price = key.price,
            category = key.rarity,
            image_url = key.image_url,
            drops = {}
        }

        for _, crate_id in pairs(key.open_crates) do
            local crate = Config.Crates[crate_id]
            if crate then
                local gen_item_id = (#KEYS[gen_id].drops + 1)
                KEYS[gen_id].drops[gen_item_id] = {
                    category = crate.rarity,
                    id = gen_item_id,
                    name = crate.name,
                    probability = 100,
                    amount = 1,
                    image_url = crate.image_url
                }
            end
        end
    end
end)